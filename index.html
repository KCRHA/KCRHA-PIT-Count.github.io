<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 Point-in-Time Count | Volunteer Portal</title>
    <link rel="icon" type="image/x-icon" href="KCRHA-logo-brandmark-full-color.png">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* CSS STYLING */
        :root {
            --primary-blue: #172B69;
            --accent-teal: #1B8477;
            --light-gray: #f4f7f9;
            --text-dark: #333333;
            --text-white: #FFFFFF;
        }
        
        .header-logo {
            max-width: 30%; /* Adjust size as needed */
            height: auto;
            margin-bottom: 1rem;
        }

        body {
            font-family: 'Arial Nova', Arial, sans-serif;
            margin: 0;
            padding: 0;
            color: var(--text-dark);
            line-height: 1.6;
        }

        header {
            background-color: var(--light-gray);
            color: var(--text-dark);
            padding: 2rem 1rem;
            text-align: center;
        }

        /* Navigation Tabs */
        nav {
            background-color: var(--accent-teal);
            display: flex;
            justify-content: left;
            overflow: auto;
            border-bottom: 2px solid var(--light-gray);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        nav button {
            background: none;
            border: none;
            padding: 1rem 2rem;
            font-size: 1rem;
            font-weight: bold;
            color: var(--text-white);
            cursor: pointer;
            transition: 0.3s;
        }
        
        nav button:hover {
            color: var(--accent-teal);
            background-color: var(--text-white);
        }
        
        nav button.active {
            border-bottom: 4px solid var(--text-dark);
            background-color: var(--accent-teal);
            color: var(--text-white);
        }
        .container {
            max-width: 900px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        
        /* Apply these to all links and buttons in the nav */
        .tab-link {
            display: inline-block; /* Crucial for links to accept padding/height */
            text-decoration: none; /* Removes the underline from the <a> tag */
            appearance: none;      /* Removes default browser button styling */
            cursor: pointer;
            
            /* Ensure these match your existing button styles */
            padding: 1rem 2rem;
            border: none; 
            background-color: none;
            color: var(--text-white);
            font-family: inherit;
            font-weight: bold;
            font-size: 1rem;
            vertical-align: middle; /* Keeps text aligned with adjacent buttons */
            line-height: normal;    /* Prevents height mismatch */
        }
        
        /* Match the hover state of your existing buttons */
        .tab-link:hover {
            color: var(--accent-teal);
            background-color: var(--text-white);
        }

        /* Professional Buttons */
        .cta-button {
            display: inline-block;
            background-color: var(--accent-teal);
            color: white;
            padding: 0.8rem 1.5rem;
            text-decoration: none;
            border-radius: 4px;
            font-weight: bold;
            margin-top: 1rem;
        }

        /* Resource Styling */
        .resource-card {
            background: var(--light-gray);
            border-left: 5px solid var(--primary-blue);
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-radius: 0 4px 4px 0;
        }

        .resource-card h3 {
            margin-top: 0;
            color: var(--primary-blue);
        }

        footer {
            text-align: center;
            padding: 2rem;
            font-size: 0.9rem;
            color: #666;
            background: var(--light-gray);
            margin-top: 4rem;
        }
        /* This makes the map look great on mobile and desktop */
        .map-container {
            position: relative;
            padding-bottom: 125%; /* Square aspect ratio */
            height: 100%;
            overflow: auto;
        }
        /* Control the style of the map widget */
        .map-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 97%;
            height: 97%;
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        /* Control the style of the calendar widget */
        .calendar-container {
            position: relative;
            overflow: hidden;
            width: 100%;
            height: 600px
            /* padding-top: 75%; /* Maintains a nice aspect ratio on mobile */ */
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        
        .calendar-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 97%;
            height: 97%;
        }
        
        /* Styling for Markdown-injected content */
        #markdown-container {
            line-height: 1.8;
            color: var(--text-dark);
        }
        
        #markdown-container h1, 
        #markdown-container h2 {
            color: var(--primary-blue);
            border-bottom: 2px solid var(--light-gray);
            padding-bottom: 0.3rem;
            margin-top: 1.5rem;
        }
        
        #markdown-container h3 {
            color: var(--accent-teal);
        }
        
        #markdown-container ul, 
        #markdown-container ol {
            padding-left: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        #markdown-container li {
            margin-bottom: 0.5rem;
        }
        
        /* Style for links inside markdown */
        #markdown-container a {
            color: var(--accent-teal);
            text-decoration: none;
            font-weight: bold;
        }
        
        #markdown-container a:hover {
            text-decoration: underline;
        }
        
        /* Style for code blocks or technical instructions */
        #markdown-container code {
            background-color: var(--light-gray);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9rem;
        }
        
        #markdown-container blockquote {
            border-left: 4px solid var(--accent-teal);
            margin: 1.5rem 0;
            padding: 0.5rem 1rem;
            background: #f9fdfc;
            font-style: italic;
        }

        /* Style for Subregion dropdown selector */
        .schedule-selector {
            max-width: 300px;
            margin: 20px auto;
            padding: 30px;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            text-align: center;
        }
    
        .styled-select {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 2px solid var(--primary-blue); /* KCRHA primary blue */
            border-radius: 4px;
            background-color: white;
            cursor: pointer;
            margin-top: 10px;
        }
    
        .styled-select:hover {
            background-color: #f9f9f9;
        }
    
        .helper-text {
            font-size: 0.85rem;
            color: #666;
            margin-top: 15px;
            font-style: italic;
        }
    
        optgroup {
            font-weight: bold;
            color: #002b5c;
            background: #f0f0f0;
        }

        /* Format the button that redirects to Doodle sign-up */
        .button-center-wrapper {
            display: flex;
            justify-content: center; /* Horizontal centering */
            align-items: center;     /* Vertical alignment */
            padding: 20px 0;         /* Adds breathing room above and below */
            width: 100%;
        }
        
        /* Optional: Ensure the button doesn't get too wide on mobile */
        #booking-button {
            max-width: 90%;
            text-align: center;
        }
    </style>
</head>
<body>

<header>
    <img src="KCRHA-logo-lockup-full-color.png" alt="KCRHA Logo" class="header-logo">
    <h1>2026 Point-in-Time Count</h1>
    <p>A vital part of our community effort to end homelessness in <a href="https://kcrha.org/community-data/king-county-point-in-time-count/" style="color: var(--primary-blue); font-weight: bold;" target="_blank">King County</a></p>
</header>

<nav id="main-nav">
    <button class="tab-link active" onclick="openTab(event, 'home')">Home</button>
    <button class="tab-link" onclick="openTab(event, 'resources')">Resources</button>
    <button class="tab-link" onclick="openTab(event, 'maps')">Hub Sites Map</button>
    <button class="tab-link" onclick="openTab(event, 'schedule')">Site Schedules</button>
    <a href="ice_response.html" target="_blank" class="tab-link ice-link">ICE Response Protocol</a>
</nav>

<div class="container">
    
    <div id="home" class="tab-content active">
        <h2>About the PIT Count</h2>
        <p>The <a href="https://kcrha.org/community-data/king-county-point-in-time-count/" style="color: var(--primary-blue); font-weight: bold;" target="_blank">Point-in-Time (PIT)</a> count is a count of sheltered and unsheltered people experiencing homelessness on a single night in January.
            <br>
            <br>
            Your participation is essential to our ability to gain the insights and funding needed to bring our neighbors indoors and bring our Homelessness Response System (HRS) to functional ZERO.</p>
        <!-- -->
        <!-- Link to section within the page without modifying the URL -->
        <a href="javascript:void(0)" 
           onclick="document.getElementById('notifications-section').scrollIntoView({behavior: 'smooth'})" 
           class="cta-button">
           <i>Check Notifications</i>
        </a>
        <br>
        <br>
        <!-- -->
        <div style="background-color: #eef2ff; padding: 1.5rem; border-radius: 8px; border: 1px solid #d1d9e6;">
            <h2 style="color: var(--primary-blue); margin-top: 0;"><u><b>Event Details</b></u></h2>
            <p><strong>2026 Unsheltered PIT Count data collection is scheduled for:<br></strong> Monday – Friday, January 26 through February 6, 2026 (weather permitting).</p>
            <p><strong>Location:</strong><br><a href="https://kcrha.github.io/KCRHA-PIT-Count.github.io/#maps" target="_blank">Regional HUB Sites</a></p>
            <a href="https://rds-test-bwdfb4akakaugcc9.westus2-01.azurewebsites.net/login" class="cta-button" target="_blank">PIT 2026 Survey Tool (Login)</a>
            <br>
            <a href="https://app.jeenie.com/v3/login?utm_source=google&utm_medium=cpc&utm_term=jeenie%20interpreter" class="cta-button" target="_blank">Jeenie Translation Services (Login)</a>
        </div>
        <br>
        <section id="notifications-section" style="background-color: #eef2ff; padding: 1.5rem; border-radius: 8px; border: 1px solid #d1d9e6;">
            <h2 style="color: var(--primary-blue); margin-top: 0;"><u><b>Updates and Notifications</b></u></h2>
            <div id="markdown-container" class="resource-card">
                Loading content...
            </div>
        </section>
    </div>

    <div id="resources" class="tab-content">
        <h2>Volunteer and Site Management Resources</h2>
        <p>Access training materials, operation manuals, reports and documents.</p>
        <div class="resource-card">
            <h3>Survey Resources</h3>
            <p>Instructions for using the mobile surveying app and paper forms for backup.</p>
            <a href="#" style="color: var(--accent-teal); font-weight: bold;">Survey App User Guide →</a>
            <br>
            <a href="#" style="color: var(--accent-teal); font-weight: bold;">Download and Print Paper Survey →</a>
        </div>

        <div class="resource-card">
            <h3>Volunteer Training and Materials</h3>
            <p>View the volunteer handbook and access volunteer training slides.</p>
            <a href="2026 Volunteer Training Manual_Final.pdf" style="color: var(--accent-teal); font-weight: bold;" target="_blank">Volunteer Handbook →</a>
            <br>
            <a href="2026 Unsheltered PIT CountHUB Leads and Surveyor Volunteer Training_final.pdf" style="color: var(--accent-teal); font-weight: bold;" target="_blank">Training Slides →</a> 
        </div>

        <div class="resource-card">
            <h3>For Site Leads</h3>
            <p>Essential resources for safe site management.</p>
            <a href="https://app.smartsheet.com/b/form/8e21239010584be4ac2d08b993c854ef" target="_blank" style="color: var(--accent-teal); font-weight: bold;">Incident Report Form →</a>
            <br>
            <a href="https://app.smartsheet.com/b/form/02f84ceb60eb4b7296dbcbcc9326e3b8" target="_blank" style="color: var(--accent-teal); font-weight: bold;">Daily Hub Close-out Form →</a>
            <br>
            <a href="#" style="color: var(--accent-teal); font-weight: bold;">Hub Site Operations Manual →</a>
        </div>
    </div>

    <!-- Add Google map of Hub Sites for ease of navigation -->
    <div id="maps" class="tab-content">
        <h2>Hub Sites Map</h2>
        <p>Use the interactive map below to locate regional resources and deployment hubs.</p>
        <div class="map-container">
            <iframe src="https://www.google.com/maps/d/u/0/embed?mid=1pR8ll32bitMux9RBMqWjToCY1oDPiug&ehbc=2E312F&noprof=1" width="640" height="480"></iframe>
        </div>
    </div>

    <!-- Add Google calendar for site schedule mgmt -->
    <div id="schedule" class="tab-content">
        <h2>Volunteer/ Site Schedules</h2>
        
        <!-- Create the Subregion selector -->
        <div class="schedule-selector">
            <h3>Select a Subregion</h3>
            <p>Select a region below to view available shifts and site schedules:</p>
            
            <!-- Add Doodle sign-up links and labels here -->
            <select id="region-menu" class="styled-select">
                <option value="" disabled selected>— Choose a Region —</option>
                <option value="https://doodle.com/sign-up-sheet/participate/9535c4a5-ddad-477c-94f9-3db163170ee0/select" data-cal="7cf70fbad7720637d804d101ad577937d04f33867b6ee59a3e28a1070741901b@group.calendar.google.com">North King County</option>
                <option value="https://doodle.com/sign-up-sheet/participate/91369666-53b7-4d1e-8d15-b34cae226bad/select" data-cal="8a55c1d6ff5d1361170f4dfe1165593ed09f206cc9907058ac3baba0a7030246@group.calendar.google.com">South King County</option>
            </select>
            <p class="helper-text">Links will open in a new tab.</p>
        </div>

        <!-- Add a button to navigate to the Doodle sign-up -->
        <div class="button-center-wrapper">
            <a id="booking-button" href="#" target="_blank" class="cta-button">
                Take me to the Sign-Up Page
            </a>
        </div>
        
        <!-- Display the calendar that corresponds to the selected subregion -->
        <div id="calendar" style="margin-top: 20px; display: none;">
            <h4>Live Schedule View</h4>
            <div class="calendar-container">
                <iframe id="calendar-iframe" src="" style="border: 0" width="100%" height="600" frameborder="0" scrolling="no"></iframe>
            </div>
        </div>
    </div>
</div>

<footer>
    &copy; King County Regional Homelessness Authority (KCRHA) | 2026 Point-in-Time Count
</footer>

<script>
    // This script changes the embedded calendar when the subregion is changed
    document.getElementById('region-menu').onchange = function() {
        var selectedOption = this.options[this.selectedIndex];
        var doodleUrl = selectedOption.value;
        var calendarId = selectedOption.getAttribute('data-cal');
        var regionName = selectedOption.text; // Gets the name like "North King County"
        
        if (calendarId) {
            var container = document.getElementById('calendar');
            var iframe = document.getElementById('calendar-iframe');
            var bookingBtn = document.getElementById('booking-button');
            
            // 1. Show the section
            container.style.display = 'block';
            container.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // 2. Update the Button link and text
            bookingBtn.href = doodleUrl;
            bookingBtn.innerText = "Sign Up for " + regionName + " on Doodle";
            
            // 3. Refresh the Calendar Iframe
            iframe.src = "about:blank"; 
            setTimeout(function() {
                var embedUrl = "https://calendar.google.com/calendar/embed?src=" +
                    encodeURIComponent(calendarId) +
                    "&ctz=America%2FLos_Angeles&mode=WEEK" +
                    "&dates=20260126/20260201" + // Adjust these dates for each week
                    "&showTitle=0&showPrint=0&showTabs=0";
                iframe.src = embedUrl;
            }, 10);
        }
    };
    // Add script to convert markdown (updates and notifications) to HTML on the fly
    async function loadMarkdown() {
        const container = document.getElementById('markdown-container');
        try {
            // This adds a timestamp to the URL, making the browser think it's a brand new file
            const response = await fetch('notifications.md?t=' + new Date().getTime());
            if (!response.ok) throw new Error('Failed to load notifications');

            const text = await response.text();

            // Create a timestamp string
            const now = new Date().toLocaleString(); 
            const stamp = `<p style="font-size: 1.0rem; color: #333333;">Last refreshed: ${now}</p>`;
        
            // Inject the stamp + the converted Markdown
            container.innerHTML = stamp + marked.parse(text);
        } catch (error) {
            container.innerHTML = "<p>Error loading documentation.</p>";
            console.error(error);
        }
    };
    // function to handle tab behavior for UI
    function openTab(evt, tabName) {
        var i, tabcontent, tablinks;

        // 1. Hide all tab content
        tabcontent = document.getElementsByClassName("tab-content");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
            tabcontent[i].classList.remove("active");
        }

        // 2. Deactivate all tab buttons
        tablinks = document.getElementsByClassName("tab-link");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].classList.remove("active");
        }

        // 3. Show the current tab and add an "active" class
        const selectedTab = document.getElementById(tabName);
        if (selectedTab) {
            selectedTab.style.display = "block";
            selectedTab.classList.add("active");
        }

        // 4. Highlight the button
        if (evt) {
            evt.currentTarget.classList.add("active");
        } else {
            // If triggered by URL (no event), find the button by text or index
            Array.from(tablinks).forEach(btn => {
                if (btn.getAttribute('onclick').includes(tabName)) {
                    btn.classList.add("active");
                }
            });
        }

        // Set special behavior for the notifications and updates tab
        if (tabName === 'home') {
            loadMarkdown();
        }

        // 5. UPDATE THE URL
        window.location.hash = tabName;
    }

    // Handle Direct Links (e.g., someone visits yoursite.com/#resources)
    window.addEventListener('DOMContentLoaded', () => {
        const currentHash = window.location.hash.replace('#', '');
        if (currentHash) {
            openTab(null, currentHash);
        }
    });

    // Handle Back/Forward buttons in the browser
    window.addEventListener('hashchange', () => {
        const currentHash = window.location.hash.replace('#', '');
        if (currentHash) {
            openTab(null, currentHash);
        }
    });

    // Trigger the load when the page starts
    window.addEventListener('DOMContentLoaded', loadMarkdown);
</script>

</body>
</html>
